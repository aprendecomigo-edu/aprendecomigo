{% extends 'dashboard_base.html' %}

{% block dashboard_css %}
<style>
    .edit-form {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    .alert-custom {
        margin-top: 15px;
    }
    .form-section {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #dee2e6;
    }
    .form-section-title {
        font-weight: bold;
        margin-bottom: 15px;
    }
</style>
{% endblock %}

{% block user_badge %}
<span class="badge bg-warning text-dark">Admin</span>
{% endblock %}

{% block user_actions %}
<div class="container mt-4">
    <h2>Edit Class Session</h2>
    <p class="lead">Update the information for this class session.</p>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-custom">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0">Session Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Google Calendar ID:</strong> {{ session.google_calendar_id }}</p>
                    <p><strong>Original Title:</strong> {{ session.title }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Created From:</strong> Google Calendar Sync</p>
                    <p>
                        <strong>Status:</strong>
                        {% if session.attended %}
                            <span class="badge bg-success">Attended</span>
                        {% else %}
                            <span class="badge bg-danger">Absent</span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="edit-form">
        <form method="post" action="{% url 'edit_session' session.id %}">
            {% csrf_token %}
            
            <div class="form-section">
                <div class="form-section-title">Basic Information</div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="teacher">Teacher:</label>
                            <select class="form-control" id="teacher" name="teacher" required>
                                {% for teacher in teachers %}
                                    <option value="{{ teacher.id }}" {% if teacher.id == session.teacher.id %}selected{% endif %}>{{ teacher.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="students">Student(s):</label>
                            <select class="form-control" id="students" name="students" multiple required>
                                {% for student in students %}
                                    <option value="{{ student.id }}" {% if student in session.students.all %}selected{% endif %}>{{ student.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple students</small>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="subject">Subject:</label>
                            <select class="form-control" id="subject" name="subject" required>
                                {% for subject in subjects %}
                                    <option value="{{ subject.id }}" {% if subject.id == session.subject.id %}selected{% endif %}>{{ subject.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label for="class_type">Class Type:</label>
                            <select class="form-control" id="class_type" name="class_type" required>
                                {% for class_type in class_types %}
                                    <option value="{{ class_type.id }}" {% if class_type.id == session.class_type.id %}selected{% endif %}>{{ class_type.name }} (â‚¬{{ class_type.hourly_rate }})</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">Date and Time</div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group mb-3">
                            <label for="start_date">Start Date:</label>
                            <input type="date" class="form-control" id="start_date" name="start_date" required value="{{ session.start_time|date:'Y-m-d' }}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group mb-3">
                            <label for="start_time">Start Time:</label>
                            <input type="time" class="form-control" id="start_time" name="start_time" required value="{{ session.start_time|time:'H:i' }}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group mb-3">
                            <label for="end_date">End Date:</label>
                            <input type="date" class="form-control" id="end_date" name="end_date" required value="{{ session.end_time|date:'Y-m-d' }}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group mb-3">
                            <label for="end_time">End Time:</label>
                            <input type="time" class="form-control" id="end_time" name="end_time" required value="{{ session.end_time|time:'H:i' }}">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">Attendance</div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="attended" name="attended" {% if session.attended %}checked{% endif %}>
                    <label class="form-check-label" for="attended">
                        Student(s) attended this class
                    </label>
                </div>
                <div class="form-text text-muted mt-2">
                    If unchecked, the session will be marked as "absent" and " - FALTOU" will be added to the title.
                </div>
            </div>
            
            <div class="form-group mt-3">
                <button type="submit" class="btn btn-primary">Update Session</button>
                <a href="{% url 'view_sessions' %}" class="btn btn-secondary">Back to Sessions</a>
                <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">Back to Dashboard</a>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Optional: Add JavaScript for form validation or dynamic behavior
    });
</script>
{% endblock %}
{% endblock %} 