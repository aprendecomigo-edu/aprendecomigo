{% extends 'dashboard/base.html' %}

{% block dashboard_css %}
<style>
    .admin-stats {
        margin: 20px 0;
        padding: 15px;
        background-color: #fffbeb;
        border-radius: 5px;
        border-left: 5px solid #ffc107;
    }
    .admin-action-card {
        margin-bottom: 15px;
        background-color: #fffbeb;
        border-left: 3px solid #ffc107;
    }
    .filter-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
    }
    .pagination {
        justify-content: center;
        margin-top: 20px;
    }
    .pagination .page-item.active .page-link {
        background-color: #ffc107;
        border-color: #ffc107;
    }
    .pagination .page-link {
        color: #212529;
    }
    .htmx-indicator {
        opacity: 0;
        transition: opacity 200ms ease-in;
    }
    .htmx-request .htmx-indicator {
        opacity: 1;
    }
    .htmx-request.htmx-indicator {
        opacity: 1;
    }
</style>
{% endblock %}

{% block user_badge %}
<span class="badge bg-warning text-dark">Admin</span>
{% endblock %}

{% block dashboard_content %}
<!-- Admin actions section -->
<div class="admin-section mt-4">
    <h3>Admin Dashboard</h3>

    <div class="admin-stats row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total Students</h5>
                    <p class="card-text display-4">{{ stats.students|default:"0" }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total Teachers</h5>
                    <p class="card-text display-4">{{ stats.teachers|default:"0" }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total Classes</h5>
                    <p class="card-text display-4">{{ stats.classes|default:"0" }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Class Types</h5>
                    <p class="card-text display-4">{{ stats.class_types|default:"0" }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card admin-action-card">
                <div class="card-body">
                    <h5 class="card-title">User Management</h5>
                    <p class="card-text">Manage user accounts, roles, and permissions.</p>
                    <a href="{% url 'admin:index' %}" class="btn btn-warning">Manage Users</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card admin-action-card">
                <div class="card-body">
                    <h5 class="card-title">Calendar Integration</h5>
                    <p class="card-text">Sync with Google Calendar to import classes.</p>
                    <button hx-get="{% url 'calendar_sync' %}" hx-target="#sync-status" class="btn btn-warning">
                        <i class="fas fa-sync me-2"></i> Sync Calendar
                        <span class="htmx-indicator spinner-border spinner-border-sm ms-1" role="status"></span>
                    </button>
                    <div id="sync-status" class="mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card admin-action-card">
                <div class="card-body">
                    <h5 class="card-title">Class Type Management</h5>
                    <p class="card-text">Create and manage class types with hourly rates.</p>
                    <a href="{% url 'manage_class_types' %}" class="btn btn-warning">Manage Class Types</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card admin-action-card">
                <div class="card-body">
                    <h5 class="card-title">System Settings</h5>
                    <p class="card-text">Configure platform settings, integrations, and preferences.</p>
                    <a href="#" class="btn btn-warning">System Settings</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Class Sessions Section -->
    <h3 class="mt-4">Class Sessions</h3>
    <div class="filter-section">
        <form hx-get="{% url 'filter_sessions' %}" hx-target="#sessions-table" hx-swap="outerHTML" hx-indicator="#filter-indicator">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="teacher">Teacher:</label>
                        <select class="form-control" id="teacher" name="teacher">
                            <option value="">All Teachers</option>
                            {% for teacher in teachers %}
                                <option value="{{ teacher.id }}" {% if selected_teacher == teacher.id %}selected{% endif %}>{{ teacher.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="student">Student:</label>
                        <select class="form-control" id="student" name="student">
                            <option value="">All Students</option>
                            {% for student in students %}
                                <option value="{{ student.id }}" {% if selected_student == student.id %}selected{% endif %}>{{ student.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="start_date">From:</label>
                        <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date|date:'Y-m-d' }}">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label for="end_date">To:</label>
                        <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date|date:'Y-m-d' }}">
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col-md-12">
                    <button type="submit" class="btn btn-primary">
                        Filter
                        <span id="filter-indicator" class="htmx-indicator spinner-border spinner-border-sm ms-1" role="status"></span>
                    </button>
                    <button hx-get="{% url 'view_sessions' %}" hx-target="#sessions-table" class="btn btn-secondary">Reset</button>
                </div>
            </div>
        </form>
    </div>

    <div id="sessions-table" hx-get="{% url 'view_sessions' %}?page=1" hx-trigger="load">
        <div class="d-flex justify-content-center py-5">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading sessions...</span>
            </div>
        </div>
    </div>
</div>
{% endblock %} 