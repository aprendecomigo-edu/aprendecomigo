{% extends 'base_with_navs.html' %}
{% load i18n %}

{% block dashboard_content %}
<div class="space-y-6" x-data="{ showForm: false }">
    
    <!-- Page Header -->
    <div class="border-b border-gray-200 pb-4">
        <div class="sm:flex sm:items-center sm:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">{% trans "Tasks" %}</h1>
                <p class="mt-1 text-sm text-gray-600">{% trans "Manage your tasks and to-do items" %}</p>
            </div>
            <div class="mt-4 sm:mt-0">
                <button 
                    @click="showForm = !showForm"
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg class="-ml-1 mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    {% trans "New Task" %}
                </button>
            </div>
        </div>
    </div>

    <!-- Task Summary Cards -->
    <div id="task-summary">
        {% include 'tasks/partials/task_summary.html' %}
    </div>

    <!-- Create Task Form -->
    <div x-show="showForm" x-transition class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
        {% include 'tasks/partials/task_form.html' with edit_mode=False %}
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
        <div class="flex flex-wrap gap-2">
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=all"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'all' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "All" %} ({{ summary.total_tasks }})
            </button>
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=pending"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'pending' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "Pending" %} ({{ summary.pending_tasks }})
            </button>
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=in_progress"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'in_progress' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "In Progress" %} ({{ summary.in_progress_tasks }})
            </button>
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=completed"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'completed' %}bg-blue-100 text-blue-800{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">
                {% trans "Completed" %} ({{ summary.completed_tasks }})
            </button>
            {% if summary.overdue_tasks > 0 %}
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=overdue"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'overdue' %}bg-red-100 text-red-800{% else %}bg-red-50 text-red-700 hover:bg-red-100{% endif %}">
                {% trans "Overdue" %} ({{ summary.overdue_tasks }})
            </button>
            {% endif %}
            {% if summary.tasks_due_today > 0 %}
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=due_today"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'due_today' %}bg-orange-100 text-orange-800{% else %}bg-orange-50 text-orange-700 hover:bg-orange-100{% endif %}">
                {% trans "Due Today" %} ({{ summary.tasks_due_today }})
            </button>
            {% endif %}
            {% if summary.urgent_tasks > 0 %}
            <button 
                hx-get="{% url 'tasks:task_list' %}?filter=urgent"
                hx-target="#task-list-content"
                hx-trigger="click"
                class="filter-btn px-3 py-1 text-sm rounded-full {% if current_filter == 'urgent' %}bg-yellow-100 text-yellow-800{% else %}bg-yellow-50 text-yellow-700 hover:bg-yellow-100{% endif %}">
                {% trans "Urgent" %} ({{ summary.urgent_tasks }})
            </button>
            {% endif %}
        </div>
    </div>

    <!-- Task List -->
    <div id="task-list-content" class="space-y-4">
        {% include 'tasks/partials/task_list_content.html' %}
    </div>

</div>

<script>
    // Handle HTMX events
    document.body.addEventListener('taskCreated', function() {
        // Close form and refresh list
        Alpine.store('showForm', false);
        htmx.trigger('#task-list-content', 'refreshTasks');
        htmx.trigger('#task-summary', 'refreshSummary');
    });

    document.body.addEventListener('taskDeleted', function() {
        htmx.trigger('#task-summary', 'refreshSummary');
    });

    document.body.addEventListener('taskUpdated', function() {
        htmx.trigger('#task-summary', 'refreshSummary');
    });
</script>
{% endblock %}