<form hx-post="{% url 'accounts:signup' %}"
      hx-target="#signup-form-container"
      hx-swap="innerHTML"
      class="w-full space-y-6"
      x-data="{ accountType: 'tutor' }">
    {% csrf_token %}

    <!-- Account Type Selection -->
    <div class="w-full">
        <div role="tablist" class="tabs tabs-border mb-6">
            <button type="button"
                    role="tab"
                    class="tab flex items-center gap-2 font-semibold text-base"
                    :class="accountType === 'tutor' ? 'tab-active font-bold' : ''"
                    @click="accountType = 'tutor'"
                    data-test="select-individual-tutor">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span>Individual Tutor</span>
            </button>
            <button type="button"
                    role="tab"
                    class="tab flex items-center gap-2 font-semibold text-base"
                    :class="accountType === 'school' ? 'tab-active font-bold' : ''"
                    @click="accountType = 'school'"
                    data-test="select-school-admin">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                <span>School Admin</span>
            </button>
        </div>

        <!-- Account Type Description -->
        <div class="alert mb-6" :class="accountType === 'tutor' ? 'alert-info' : 'alert-success'">
            <svg class="w-6 h-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
                <p x-show="accountType === 'tutor'" class="text-sm">
                    Register as an individual tutor to start your own tutoring practice
                </p>
                <p x-show="accountType === 'school'" class="text-sm">
                    Register as a school administrator to manage your educational institution
                </p>
            </div>
        </div>
    </div>

    <!-- Hidden field to track account type -->
    <input type="hidden" name="account_type" :value="accountType">

    <!-- Personal Information Section -->
    <div class="space-y-4">
        <h3 class="text-lg font-primary font-semibold text-base-content">Personal Information</h3>

        <!-- Full Name Field -->
        <fieldset class="fieldset">
            <legend class="fieldset-legend font-primary font-medium">Full Name</legend>
            <input type="text"
                   name="full_name"
                   value="{{ full_name|default:'' }}"
                   placeholder="Enter your full name"
                   class="input input-lg w-full glass-light p-4 rounded-xl"
                   autocomplete="name"
                   data-test="input-full-name"
                   required />
        </fieldset>

        <!-- Email Field -->
        <fieldset class="fieldset">
            <legend class="fieldset-legend font-primary font-medium">Email Address</legend>
            <input type="email"
                   name="email"
                   value="{{ email|default:'' }}"
                   placeholder="Enter your email address"
                   class="input input-lg w-full glass-light p-4 rounded-xl"
                   pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                   title="Must be a valid email address"
                   autocomplete="email"
                   data-test="input-email"
                   required />
        </fieldset>

        <!-- Phone Number Field -->
        <fieldset class="fieldset">
            <legend class="fieldset-legend font-primary font-medium">Phone Number</legend>
            <input type="tel"
                   name="phone_number"
                   value="{{ phone_number|default:'' }}"
                   placeholder="+1 (555) 123-4567"
                   class="input input-lg w-full glass-light p-4 rounded-xl"
                   pattern="^\+\d{1,3}\s?\d{9,}$"
                   title="Must be a valid phone number with country code"
                   autocomplete="tel"
                   data-test="input-phone" />
        </fieldset>
    </div>

    <!-- Practice/School Information Section -->
    <div class="space-y-4">
        <h3 class="text-lg font-primary font-semibold text-base-content"
            x-text="accountType === 'tutor' ? 'Practice Information' : 'School Information'">
        </h3>

        <fieldset class="fieldset">
            <legend class="fieldset-legend font-primary font-medium"
                    x-text="accountType === 'tutor' ? 'Practice Name' : 'School Name'">
            </legend>
            <input type="text"
                   name="organization_name"
                   :placeholder="accountType === 'tutor' ? 'Your practice name' : 'Your school name'"
                   value="{{ organization_name|default:'' }}"
                   class="input input-lg w-full glass-light p-4 rounded-xl"
                   autocomplete="organization"
                   data-test="input-school-name"
                   required />
        </fieldset>
    </div>

    <!-- Server-side error message -->
    {% if error %}
    <div class="alert alert-error" data-test="error-validation">
        <svg class="w-6 h-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>{{ error }}</span>
    </div>
    {% endif %}

    <!-- Submit Button -->
    <div class="relative">
        <button type="submit"
                class="btn btn-neutral w-full bg-gradient-primary border-none text-white htmx-request:opacity-50 htmx-request:pointer-events-none"
                data-test="submit-registration">
            <span class="htmx-indicator-none">Create Account</span>
            <span class="htmx-indicator" data-test="loading-registration">
                <div class="loading loading-spinner loading-sm"></div>
                Creating Account...
            </span>
        </button>

        <!-- Loading Spinner Overlay -->
        <div class="htmx-indicator absolute inset-0 flex items-center justify-center bg-base-100/50 backdrop-blur-sm rounded-lg opacity-0 invisible" data-test="loading-registration">
            <div class="loading loading-spinner loading-md text-primary"></div>
        </div>
    </div>
</form>
