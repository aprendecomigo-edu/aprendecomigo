<!-- Consolidated Sign-In Form - Email Input and Delivery Choice on Same Page -->
<div class="w-full space-y-8" x-data="{ email: '{{ email|default:'' }}' }">
    <!-- Email Input Field -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-primary font-medium">Email address</span>
        </label>
        <div class="relative">
            <label class="input validator glass-light w-full">
                <input type="email"
                       x-model="email"
                       placeholder="your_email@example.com"
                       pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                       title="Must be a valid email address"
                       autocomplete="email"
                       required />
            </label>
            <div class="validator-hint">
                Must be a valid email address
            </div>

            <!-- Server-side error message -->
            {% if error %}
            <div class="validator-hint text-error">
                {{ error }}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Delivery Method Options -->
    <div class="space-y-4">
        <div class="text-center">
            <span class="label-text font-primary font-medium">Choose how to receive your sign-in code:</span>
        </div>

        <!-- Email Option -->
        <form hx-post="{% url 'accounts:send_otp_email' %}"
              hx-target="#signin-form-container"
              hx-swap="innerHTML"
              class="w-full">
            {% csrf_token %}
            <input type="hidden" name="email" x-bind:value="email" />
            <button type="submit"
                    class="btn btn-primary w-full bg-gradient-primary glass-light htmx-request:opacity-50 htmx-request:pointer-events-none"
                    x-bind:disabled="!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)">
                <span class="htmx-indicator loading loading-spinner loading-sm opacity-0"></span>
                Send Code via Email
            </button>
        </form>

        <!-- SMS Option - conditionally shown based on waffle flag -->
        {% if sms_enabled %}
        <form hx-post="{% url 'accounts:send_otp_sms' %}"
              hx-target="#signin-form-container"
              hx-swap="innerHTML"
              class="w-full">
            {% csrf_token %}
            <input type="hidden" name="email" x-bind:value="email" />
            <button type="submit"
                    class="btn btn-secondary w-full glass-light htmx-request:opacity-50 htmx-request:pointer-events-none"
                    x-bind:disabled="!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)">
                <span class="htmx-indicator loading loading-spinner loading-sm opacity-0"></span>
                Send Code via SMS
            </button>
        </form>
        {% endif %}
    </div>
</div>
