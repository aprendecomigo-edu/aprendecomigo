{% if show_delivery_choice %}
<!-- Delivery Choice UI -->
<div class="w-full space-y-6">
    <div class="form-control">
        <label class="label">
            <span class="label-text font-primary font-medium">Email: {{ email }}</span>
        </label>
    </div>

    <!-- Email Option -->
    <form hx-post="{% url 'accounts:send_otp_email' %}"
          hx-target="#signin-form-container"
          hx-swap="innerHTML"
          class="w-full">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary w-full bg-gradient-primary glass-light">
            Send Code via Email
        </button>
    </form>

    <!-- SMS Option (Disabled for now) -->
    <button class="btn btn-neutral w-full glass-light" disabled>
        Send Code via SMS (Coming Soon)
    </button>

    <!-- Back to edit email -->
    <div class="text-center">
        <button hx-get="{% url 'accounts:signin' %}"
                hx-target="#signin-form-container"
                hx-swap="innerHTML"
                class="link link-neutral text-sm">
            Change email address
        </button>
    </div>
</div>

{% else %}
<!-- Email Input Form -->
<form hx-post="{% url 'accounts:signin' %}"
      hx-target="#signin-form-container"
      hx-swap="innerHTML"
      class="w-full space-y-8">
    {% csrf_token %}

    <!-- Email or Phone Field with Join Component -->
    <div class="form-control">
        <label class="label">
            <span class="label-text font-primary font-medium">Email address</span>
        </label>
        <div class="relative">
            <div class="join w-full htmx-request:opacity-50 htmx-request:pointer-events-none transition-opacity">
                <div class="flex-1">
                    <label class="input validator join-item glass-light w-full">
                        <input type="text"
                               name="email"
                               value="{{ email|default:'' }}"
                               placeholder="your_email@example.com"
                               pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
                               title="Must be a valid email address"
                               autocomplete="email"
                               required />
                    </label>
                    <div class="validator-hint">
                        Must be a valid email address
                    </div>

                    <!-- Server-side error message -->
                    {% if error %}
                    <div class="validator-hint text-error">
                        {{ error }}
                    </div>
                    {% endif %}
                </div>

                <button type="submit" class="btn btn-neutral join-item bg-gradient-primary glass-light shrink-0">
                    Continue
                </button>
            </div>

            <!-- Loading Spinner Overlay -->
            <div class="htmx-indicator absolute inset-0 flex items-center justify-center bg-base-100/50 backdrop-blur-sm rounded-lg opacity-0 invisible">
                <div class="loading loading-spinner loading-md text-primary"></div>
            </div>
        </div>
    </div>
</form>
{% endif %}
