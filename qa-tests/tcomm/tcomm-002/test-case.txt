QA Test Case: Automated Communication Workflow Test

Test ID: TCOMM-002
Test Name: Automated Communication Workflow Test
Purpose: Verify that automated email sequences are properly triggered by teacher invitation status changes and workflow events
Expected Result: Automated email workflows function correctly with proper triggers, sequencing, and delivery

=== CONTEXT (Pre-test Requirements) ===

System Information:
- Project: Aprende Comigo Platform
- Architecture: Django REST Framework backend with Django Channels for WebSocket support
- Focus: Automated Email Communication Workflows (GitHub Issues #99, #100)

Required Environment Setup:
1. Project Location: /Users/anapmc/Code/aprendecomigo/backend
2. Python Virtual Environment: .venv/ in project root
3. `make dev` to start development servers with background task processing
4. Email backend configured for testing (check SMTP settings)

Test Data:
- Test School Owner Email: anapmc.carvalho@gmail.com
- Test Teacher Email: teacher.test@example.com
- Email Sequence Types: invitation_sequence, onboarding_sequence, milestone_sequence
- Database Models: EmailSequence, EmailSequenceStep, EmailCommunication

=== DETAILED STEP-BY-STEP INSTRUCTIONS ===

Step 1: Environment Setup and Service Verification
1. Start development servers with background task processing
2. Verify email service is configured and running
3. Check that email sequence models are properly migrated
Commands:
  cd /Users/anapmc/Code/aprendecomigo/backend
  source .venv/bin/activate
  make dev
  python manage.py shell -c "from accounts.models import EmailSequence; print(f'Email sequences: {EmailSequence.objects.count()}')"

Expected: Servers start and email sequence models are accessible
Screenshot: 01_servers_and_email_service_ready.png
Debug: Check Django logs for email backend configuration

Step 2: School Owner Login and Setup
1. Open browser to http://localhost:8081
2. Login as school owner: anapmc.carvalho@gmail.com
3. Navigate to communication dashboard
4. Verify existing email sequences are displayed
5. Check sequence configuration options

Expected: Access to email sequence management interface
Screenshot: 02_email_sequences_dashboard.png

Step 3: Create Teacher Invitation Sequence
1. Navigate to email sequence creation
2. Create new sequence: "Teacher Invitation Workflow"
3. Set trigger: "teacher_invitation_sent"
4. Add sequence steps:
   - Step 1: Welcome email (immediate)
   - Step 2: Onboarding tips (1 day delay)
   - Step 3: Profile completion reminder (3 days delay)
   - Step 4: Final welcome (7 days delay)
5. Configure each step with appropriate templates
6. Activate the sequence

Expected: Multi-step email sequence created and activated
Screenshot: 03_invitation_sequence_created.png

Step 4: Test Teacher Invitation Trigger
1. Navigate to teacher management/invitation section
2. Send invitation to test teacher: teacher.test@example.com
3. Monitor email sequence trigger in real-time
4. Check communication logs for sequence initiation
5. Verify first email in sequence is queued/sent

Expected: Invitation sending triggers automated email sequence
Screenshot: 04_sequence_triggered_by_invitation.png
Debug: Check Django admin or logs for EmailCommunication records

Step 5: Test Sequence Step Progression
1. Monitor email sequence execution over time
2. Check that steps are executed according to configured delays
3. Verify each step creates proper EmailCommunication records
4. Test sequence step status tracking (pending, sent, failed)
5. Verify sequence completion status

Expected: Email sequence steps execute according to timing configuration
Screenshot: 05_sequence_steps_progression.png
Note: May require time simulation or fast-forward testing

Step 6: Test Profile Completion Milestone Trigger
1. Simulate teacher accepting invitation
2. Navigate to teacher profile completion workflow
3. Trigger profile milestone events:
   - Profile 25% complete
   - Profile 50% complete
   - Profile 75% complete
   - Profile 100% complete
4. Verify milestone-based email triggers
5. Check milestone celebration emails

Expected: Profile completion milestones trigger appropriate email communications
Screenshot: 06_milestone_triggered_emails.png

Step 7: Test Onboarding Sequence Integration
1. Create onboarding email sequence
2. Set trigger: "teacher_invitation_accepted" 
3. Configure onboarding steps:
   - Welcome to the team (immediate)
   - Getting started guide (6 hours)
   - First week tips (1 day)
   - Resources and support (3 days)
4. Test sequence activation upon invitation acceptance

Expected: Onboarding sequence integrates with invitation acceptance workflow
Screenshot: 07_onboarding_sequence_integration.png

Step 8: Test Email Content Personalization
1. Verify email sequences use proper template variables
2. Check personalization with teacher name, school name, etc.
3. Test different email templates within sequences
4. Verify school branding is applied to sequence emails
5. Check both HTML and text versions of sequence emails

Expected: Email sequences properly personalize content and apply branding
Screenshot: 08_personalized_sequence_emails.png

Step 9: Test Sequence Management and Monitoring
1. Access email sequence monitoring dashboard
2. Review sequence execution logs and statistics
3. Test sequence pause/resume functionality
4. Test sequence modification and versioning
5. Check sequence performance analytics (open rates, click rates)

Expected: Comprehensive sequence management and monitoring capabilities
Screenshot: 09_sequence_monitoring_dashboard.png

Step 10: Test Error Handling and Recovery
1. Test sequence behavior with email delivery failures
2. Test sequence continuation after system restart
3. Test sequence handling with invalid recipient addresses
4. Verify error logging and notification systems
5. Test manual sequence intervention and recovery

Expected: Robust error handling and recovery mechanisms for email sequences
Screenshot: 10_error_handling_recovery.png

Step 11: Test Multiple Concurrent Sequences
1. Create multiple different email sequences
2. Test overlapping sequences for same user
3. Verify sequence isolation and proper execution
4. Test sequence priority and conflict resolution
5. Check database performance with multiple active sequences

Expected: Multiple email sequences can run concurrently without conflicts
Screenshot: 11_concurrent_sequences_testing.png

Step 12: Integration with Communication Dashboard
1. Verify sequences appear in communication analytics
2. Test sequence metrics and reporting
3. Check integration with overall communication statistics
4. Test sequence export and reporting features
5. Verify sequence data consistency across dashboard

Expected: Email sequences integrate properly with communication dashboard and analytics
Screenshot: 12_dashboard_integration_complete.png

=== PASS/FAIL CRITERIA ===

PASS: All steps complete AND all of the following conditions are met:
- Email sequence creation and configuration works properly
- Teacher invitation properly triggers automated email sequences
- Sequence steps execute according to configured timing
- Profile completion milestones trigger appropriate emails
- Onboarding sequences integrate with invitation acceptance
- Email content is properly personalized with template variables
- Sequence management and monitoring features function correctly
- Error handling and recovery mechanisms work as expected
- Multiple concurrent sequences execute without conflicts
- Communication dashboard integration works properly
- No database errors or email delivery failures occur
- All sequence logs and analytics are accurate

FAIL: Any step fails OR any of the following occurs:
- Email sequence creation fails or produces errors
- Teacher invitation doesn't trigger automated sequences
- Sequence timing is incorrect or steps don't execute
- Milestone triggers fail to initiate emails
- Onboarding integration is broken or missing
- Email personalization fails or shows template errors
- Sequence management features are non-functional
- Error handling is inadequate or causes system failures
- Concurrent sequences interfere with each other
- Dashboard integration shows incorrect or missing data
- Database errors or email service failures occur
- Server errors or console errors during sequence execution

Individual Step Criteria:
- Step 1: PASS if email services start properly, FAIL if configuration issues
- Step 2: PASS if dashboard access works, FAIL if authentication or navigation issues
- Step 3: PASS if sequence creation works, FAIL if form errors or save failures
- Step 4: PASS if invitation triggers sequence, FAIL if trigger mechanism broken
- Step 5: PASS if steps execute on schedule, FAIL if timing or execution issues
- Step 6: PASS if milestones trigger emails, FAIL if milestone detection broken
- Step 7: PASS if onboarding integration works, FAIL if workflow disconnection
- Step 8: PASS if personalization works, FAIL if template variable issues
- Step 9: PASS if monitoring features work, FAIL if dashboard or analytics broken
- Step 10: PASS if error handling works, FAIL if poor recovery or logging
- Step 11: PASS if concurrent sequences work, FAIL if conflicts or interference
- Step 12: PASS if dashboard integration works, FAIL if data inconsistencies

Overall Result: PASS only if ALL steps pass, FAIL if ANY step fails