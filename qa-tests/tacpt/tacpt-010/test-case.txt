QA Test Case: Duplicate Membership Handling

Test ID: TACPT-010
Test Name: Duplicate Membership Handling
Purpose: Verify graceful handling when teacher attempts to join school they're already a member of
Expected Result: Clear error message with information about existing membership

=== CONTEXT (Pre-test Requirements) ===

System Information:
- Project: Aprende Comigo Platform
- Architecture: Django backend (localhost:8000) + React Native frontend (localhost:8081)
- GitHub Issue: #52 - Duplicate membership error handling

Required Environment Setup:
1. Project Location: /Users/anapmc/Code/aprendecomigo
2. Development servers: `make dev`
3. Database: PostgreSQL with test data

Test Data:
- Teacher email: existing.member@aprendecomigo.com
- School: Test School (teacher is already a member)
- New invitation token for same teacher/school combination

Pre-test Database State:
- Teacher already has active membership in school
- New invitation exists for same teacher/school

=== DETAILED STEP-BY-STEP INSTRUCTIONS ===

Step 1: Setup Existing Membership
1. Verify teacher already has membership in target school
2. Create new invitation for same teacher/school
3. Confirm both membership and invitation exist in database
Commands:
  python manage.py shell
  from accounts.models import SchoolMembership, TeacherInvitation
  # Verify existing membership and new invitation

Expected: Teacher has existing membership and new invitation
Screenshot: 01_duplicate_scenario_setup.png

Step 2: Access Duplicate Invitation
1. Navigate to new invitation URL
2. Authenticate as existing member teacher
3. Observe system behavior
URL: http://localhost:8081/accept-invitation/[NEW_TOKEN]

Expected: System detects existing membership
Screenshot: 02_duplicate_invitation_accessed.png

Step 3: Verify Duplicate Detection Message
1. Check that clear message about existing membership appears
2. Verify message explains teacher is already a member
3. Confirm professional, helpful tone
4. Check for information about current membership

Expected: Clear message about existing membership with helpful details
Screenshot: 03_duplicate_detection_message.png

Step 4: Test Navigation to Current Membership
1. Look for option to go to current school dashboard
2. Test link to view existing membership details
3. Verify teacher can access their current school context
4. Check that existing permissions are maintained

Expected: Easy navigation to existing school membership
Screenshot: 04_navigation_to_existing_membership.png

Step 5: Verify No Duplicate Creation
1. Confirm no second membership is created
2. Check that original membership is unchanged
3. Verify invitation status is handled appropriately
4. Test that database remains consistent

Expected: No duplicate memberships created, database stays consistent
Screenshot: 05_no_duplicate_verification.png

Step 6: Test Multiple School Scenario
1. If teacher has memberships in multiple schools, verify all are shown
2. Check that existing membership information is accurate
3. Test that teacher can switch to any existing school
4. Confirm multi-school dashboard integration

Expected: All existing memberships properly displayed and accessible
Screenshot: 06_multiple_school_scenario.png

=== PASS/FAIL CRITERIA ===

PASS: Duplicate membership detected with clear guidance and no database issues
FAIL: Duplicate membership created or poor error handling

Overall Result: PASS only if ALL steps pass, FAIL if ANY step fails